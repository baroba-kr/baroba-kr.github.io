(function(e){var t=[],n={},o=!1,a=window.location.host?"web":process.versions.electron?"pc":"mobile",l=window.location.host?"//"+window.location.host:"//www.baroba.kr",r=l.replace("www.","").replace("//","//api."),s="",c=function(){s=setTimeout(c,300),t&&t.length>0&&(e.post(r+"/request/?",{item:JSON.stringify(t)},function(t){for(i in t.payload){var n=t.payload[i],o="cb_"+n.method;window[o]&&window[o](e.parseJSON(n.data))}},"json"),t=[])},m=function(e,n,o){var a={method:e,params:n},l="cb_"+e;for(i in t)if(t[i].method==e)return;t.push(a),window[l]=o},d=function(){const e=decodeURIComponent(window.location.hash)+"";return e?e.substr(1):""},u=function(e){window.location.href="#"+e},f=function(e){var t;return t=e.indexOf("//")>-1?e.split("/")[2]:e.split("/")[0],t=t.split(":")[0],t=t.split("?")[0],t},p=function(e){var t=f(e),n=t.split("."),o=n.length;return o>2&&(t=n[o-2]+"."+n[o-1],2==n[o-2].length&&2==n[o-1].length&&(t=n[o-3]+"."+t)),t=t.split("."),t[0]},v=function(){return m("login",{userid:e("[name=userid]").val(),userpw:e("[name=userpw]").val()},function(t){if(t&&t.success&&t.payload)e("[name=btn-login],[name=btn-join]").addClass("d-none"),e("[name=btn-logout]").removeClass("d-none"),sessionStorage.delete_movie=t.payload.delete_movie,location.href="#";else{var n=t.error&&t.error.message?t.error.message:"로그인 정보가 올바른지 확인해주세요.";alert(n)}}),!1},g=function(){return m("addParser",{url:e("[name=url]").val(),category:e("[name=category]").val(),active:e("[name=active]").val(),free:e("[name=free]").val(),adult:e("[name=adult]").val(),interval:e("[name=interval]").val(),site_no:e("[name=site_no]").val(),interval:e("[name=interval]").val(),ordinal:e("[name=ordinal]").val()},function(t){if(t&&t.success&&t.payload)e("[name=btn-login],[name=btn-join]").addClass("d-none"),e("[name=btn-logout]").removeClass("d-none"),sessionStorage.delete_movie=t.payload.delete_movie,location.href="#";else{var n=t.error&&t.error.message?t.error.message:"로그인 정보가 올바른지 확인해주세요.";alert(n)}}),!1},h=function(){return m("addMovie",{url:e("[name=movie_url]").val(),category:e("[name=categories]").val(),title:e("[name=title]").val(),regdate:e("[name=regdate]").val(),poster_url:e("[name=poster_url]").val(),free:e("[name=free]").val(),adult:e("[name=adult]").val()},function(t){if(t&&t.success&&t.payload)alert("저장 완료"),e("[name=form_save_movie]").reset(),location.href="#";else{var n=t.error&&t.error.message?t.error.message:"로그인 정보가 올바른지 확인해주세요.";alert("저장 실패. "+n)}}),!1},w=function(e){let t="";return e.indexOf("//youtu.be/")>-1?t=e.replace(/.*\/\/youtu.be\//,"").replace(/\&.*/,""):e.indexOf("//youtube.com/watch?v=")>-1?t=e.replace(/.*\/\/youtube.com\/watch\?v=/,"").replace(/\&.*/,""):e.indexOf("//m.youtube.com/watch?v=")>-1?t=e.replace(/.*\/\/m.youtube.com\/watch\?v=/,"").replace(/\&.*/,""):e.indexOf("//www.youtube.com/watch?v=")>-1?t=e.replace(/.*\/\/www.youtube.com\/watch\?v=/,"").replace(/\&.*/,""):e.indexOf("www.youtube.com/embed/")>-1&&(t=videourl.replace("https://www.youtube.com/embed/",""),t&&t.indexOf("?")>-1&&(t=t.substr(0,t.indexOf("?")))),t},b=function(t){let n={};if(t.indexOf("youtube")>-1){let o=w(t);n.id=o,n.movie_url="https://www.youtube.com/embed/"+o,e.get({url:"https://www.youtube.com/oembed?format=xml&url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D"+o,async:!1,success:function(t){console.log(t),$res=e(t),n.poster_url=$res.find("thumbnail_url").text(),n.title=$res.find("title").text(),n.author_name=$res.find("author_name").text(),n.author_url=$res.find("author_url").text(),n.type=$res.find("type").text()}})}return n},y=function(e){var t=window.location.search.substring(1),n=t.split("&");let o="";if(e=(e+"").trim(),!e)return o;e+="=";for(var a=0;a<n.length;a++){let t=n[a],i=t.indexOf(e);if(i>-1){o=t.substr(i+e.length);break}}return o},_=function(e,t,n){let o=n||window.location.search,a=(o.indexOf("?")>-1?o.substring(o.indexOf("?")+1).length:o.length,o.split("?",2));return o=o.indexOf(e+"=")>-1?o.replace(new RegExp(e+"=(.[^&]*)?(&|)","g"),e+"="+t+"$2",o):a[1]?o+"&"+e+"="+t:a[0]+"?"+e+"="+t,o},k=40;c(),sessionStorage.delete_movie=sessionStorage.delete_movie?sessionStorage.delete_movie:"N",e(window).blur(function(){s=clearTimeout(s)}),e(window).focus(function(){s||c()});var x=0,C=function(){var t=e("[name=poster_box]:last").width(),n=9*t/16,o=200;if(t>0&&x!=t){x=t;var a="[name=poster_box]{height:"+n+"px;}",i=e("style[name=poster_box_style]");i.length>0?i.empty().append(a):e("head").append('<style name="poster_box_style">'+a+"</style>")}else o=1e3;setTimeout(function(){C()},o)},T=!0,O=function(e){var t='<div name="item" data-movie="{movieurl}" data-movieno="{movieno}" data-time="{time}" class="item">            <!-- <a href="#" class="poster_box_link"><div name="poster_box" style="background-image:url(resource/image/no-img.png);display:block" data-src="{posterurl}" class=" btn m-0 p-0 blazyload"></div></a>-->            <a href="#" class="poster_box_link"><div name="poster_box" style="background-image:url({posterurl});display:block" data-src="{posterurl}" class=" btn m-0 p-0 "></div></a>            <p name="ctrl">                <span class="text-muted">                    {root_domain}                     {date}                </span>                <span name="icon" class="float-right">                    <a href="#" name="{like_name}"><i class="{like_class} fa-heart d-none"></i></a>&nbsp;                    <a href="#" name="delete" class="{hide_delete_btn}"><i class="fas fa-trash-alt"></i></a>                    <a href="#" name="share"><i class="fas fa-share-alt d-none"></i></a>&nbsp;                    <a href="#" name="close" class="d-none"><i class="fas fa-times"></i></a>&nbsp;                </span>            </p>            <p name="title">                {title}             </p>        </div>',o=[],a=localStorage.getItem("like");for(i in e){var l=e[i],r=l.time,s=new Date(1e3*r),c=s.getMonth()+1,m=s.getDate()<10?"0"+s.getDate():s.getDate(),d=s.getHours()<10?"0"+s.getHours():s.getHours(),u=s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes(),f=c+"."+m+" "+d+":"+u,v=l.poster?l.poster:"resource/image/no-img.png",g=a?a.indexOf(l.movie_no):-1,h=g<0?"unlike":"like",w=g<0?"far":"fas";void 0===n[l.movie_no]&&(o.push(t.replace(/{posterurl}/g,v).replace(/{movieurl}/g,l.url).replace(/{time}/g,l.time).replace(/{movieno}/g,l.movie_no).replace(/{title}/g,l.title).replace(/{date}/g,f).replace(/{root_domain}/g,p(l.url).toUpperCase()).replace(/{like_name}/g,h).replace(/{like_class}/g,w).replace("{hide_delete_btn}","Y"==sessionStorage.delete_movie?"":"d-none")),n[l.movie_no]=!0,setTimeout(function(){z()},1e3))}return o},S=null,M=function(t){if(t&&t.success){var n=e("[name=item]").length;e("#searching").addClass("d-none"),(!t.payload||t.payload&&t.payload.length<1)&&(e("#btn-more").addClass("d-none"),e("[name=item]").length<1&&e("#empty-result").removeClass("d-none")),e("#empty-result").addClass("d-none");var o=e("#list"),a=O(t.payload);o.append(a.join("")),C(),T?(T=!1,search_date=y("date"),S=e("[name=item]:eq(0)"),m("getMovieList",{c:d(),cnt:k,time:S.attr("data-time"),date:search_date,direction:"back"},j)):S=null,"Y"==sessionStorage.delete_movie&&e("[name=delete].d-none").removeClass("d-none"),t.payload&&t.payload.length<k?e("#btn-more").addClass("d-none"):e("#btn-more").removeClass("d-none").attr("data-time",e("[name=item]:last").attr("data-time")),n<1&&(e(window).scrollTop(0),q=q,setTimeout(function(){q=!1,q=!0},1e3)),P=!0}},j=function(t){if(t&&t.success){if(t.payload&&!(t.payload&&t.payload.length<1)){var n=e("#list"),o=O(t.payload);n.prepend(o.join("")),C(),"Y"==sessionStorage.delete_movie&&e("[name=delete].d-none").removeClass("d-none"),S&&(e(window).scrollTop(S.offset().top-70),S=null),$=!0}}else S=null},D=function(){e("#list").empty(),n={}},I=(t,n)=>{console.log(t,e('footer a[href="#'+t+'"]').length,e('footer a[href="#'+t+'"]').length<1),e('footer a[href="#'+t+'"]').length<1&&(n&&(Y.push(t),Y=Y.filter((e,t,n)=>n.indexOf(e)===t&&e),localStorage.setItem("tabKeywords",Y)),e("footer > div").append('<a href="#'+t+'"><div>'+t+"</div></a>"))},Y=(localStorage.getItem("tabKeywords")||"").split(",");for(i in e("footer > div > *").each(function(){Y.push(e(this).attr("href").replace("#",""))}),Y=Y.filter((e,t,n)=>n.indexOf(e)===t&&e),console.log(Y),Y)I(Y[i]);var N=function(){e(document).focus();var t=d();switch(e(".board").addClass("d-none"),t){case"login":e("[name=login]").removeClass("d-none");break;case"logout":m("logout",{},function(){sessionStorage.delete_movie="N",e("[name=btn-login],[name=btn-join]").removeClass("d-none"),e("[name=btn-logout]").addClass("d-none"),window.location.href="#"});break;case"join":e("[name=join]").removeClass("d-none");break;case"addparser":o?e("[name=addparser]").removeClass("d-none"):alert("로그인 해주세요.");break;case"addvideo":o?e("[name=addvideo]").removeClass("d-none"):(alert("로그인 해주세요."),u("login"));break;default:if(D(),t){let e=document.title+"";e=e.indexOf(" - ")>-1?e.substring(0,e.indexOf(" - ")):e,document.title=e+" - "+t}if(e("#searching").removeClass("d-none"),e("[name=main]").removeClass("d-none"),e("#btn-more").addClass("d-none"),lastMovieTime=localStorage[t],!lastMovieTime){let e=new Date,n=e.getHours()<6?new Date(e.getFullYear(),e.getMonth(),e.getDate()-1,12,0,0,0):new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0);lastMovieTime=Math.floor(n.getTime()/1e3),localStorage.setItem(t,lastMovieTime)}search_date=y("date"),console.log("search_date:",search_date),m("getMovieList",{c:t,cnt:k,time:lastMovieTime,date:search_date},M),I(t,!0)}};m("isLogin",{},function(t){t&&t.success&&t.payload?(o=t.payload,e("[name=btn-login],[name=btn-join]").addClass("d-none"),e("[name=btn-logout]").removeClass("d-none")):(e("[name=btn-login],[name=btn-join]").removeClass("d-none"),e("[name=btn-logout]").addClass("d-none"))});var P=!0,$=!0,F=1e3,H=800,J=function(){e(window).scrollTop()<=F&&$&&(search_date=y("date"),$=!1,m("getMovieList",{c:d(),cnt:k,time:e("[name=item]:eq(0)").attr("data-time"),date:search_date,direction:"back"},j))},L=function(){e(window).scrollTop()+e(window).height()>=e(document).height()-H&&e("#btn-more").is(":visible")&&P&&e("#btn-more").click()},q=!0,z=function(){if(!q)return;var t=e(window),n=e("[name=item]"),o=Math.floor(t.width()/n.width()),a=(o=o>5?5:o,Math.floor(t.scrollTop()/(n.height()+20))*o),i=n.eq(a).attr("data-time"),l=d();l=l||"";const r=localStorage.getItem(l);i&&i>r&&localStorage.setItem(l,i)},B=function(){P=!1,m("getMovieList",{time:e("[name=item]:last").attr("data-time"),c:d(),cnt:k},M)};N(),window.addEventListener("hashchange",function(e){T=!0,N()});var E=0,K=function(t){$=!1,P=!1;e(window).outerWidth();var n=e(t).parents("[name=item]"),o=n.attr("data-movie"),i=(o=window.location.href.indexOf("https://")>-1&&o.indexOf("mgoon.com")>-1?o.replace("http://","https://"):o,n.attr("data-movieno")),l=o.match(/\.gif/i)?"image":"video",r=n.find("[name=ctrl]"),s=n.find("[name=title]"),c=e("image"==l?'<img class=" arve-iframe fitvidsignore" name="movie" src="'+o+'" width="100%" height="auto">':'<iframe class="popup_movie arve-iframe fitvidsignore" frameborder="0" name="movie" scrolling="no" src="'+o+'" width="100%" height="auto" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture; fullscreen" allowfullscreen></iframe>');e(".popup_movie").remove(),e(".preloader").removeClass("d-none"),e("[name=movie_area]").html(c),e("[name=ctrlbox]").html(r.html()).find("[name=close]").removeClass("d-none"),e("[name=titlebox]").html(s.html()),E=e(document).scrollTop(),e("main").height("auto").css({overflow:"auto"}),e("main").height(e(window).innerHeight()-56-20+E).css({overflow:"hidden","margin-top":-1*E}),e(".popup_bg").removeClass("d-none"),"video"==l&&c.height(9*c.width()/16),c.on("load",function(){if(e(".preloader").addClass("d-none"),"web"!=a){var t=200;if(o.indexOf("naver.com")>-1){var n=function(e){c.contents().find(".u_rmc_btn_skip").length>0?(c.contents().find(".u_rmc_btn_skip").click(),window._autoplay=setTimeout(function(){n(e)},e)):clearTimeout(window._autoplay)},i=function(e){c.contents().find(".u_rmc_navertv_ic").length>0?(c.contents().find(".u_rmc_navertv_ic").click(),n(e)):window._autoplay=setTimeout(function(){i(e)},e)};window._autoplay=setTimeout(function(){i(t)},t)}else if(o.indexOf("streamango.com")>-1){i=function(e){c.contents().find(".vjs-big-play-button").length>0?(c.contents().find(".vjs-big-play-button").click(),clearTimeout(window._autoplay)):window._autoplay=setTimeout(function(){i(e)},e)};window._autoplay=setTimeout(function(){i(t)},t)}else if(o.indexOf("dailymotion.com")>-1){i=function(e){c.contents().find(".np_ButtonPlayback").length>0?(c.contents().find(".np_ButtonPlayback").click(),clearTimeout(window._autoplay)):window._autoplay=setTimeout(function(){i(e)},e)};window._autoplay=setTimeout(function(){i(t)},t)}else if(o.indexOf("youtube.com")>-1){i=function(e){c.contents().find(".ytp-large-play-button").length>0?(c.contents().find(".ytp-large-play-button").click(),clearTimeout(window._autoplay)):window._autoplay=setTimeout(function(){i(e)},e)};window._autoplay=setTimeout(function(){i(t)},t)}else{i=function(e){c.contents().find("button").length>0?(c.contents().find("button").click(),clearTimeout(window._autoplay)):window._autoplay=setTimeout(function(){i(e)},e)};window._autoplay=setTimeout(function(){i(t)},t)}}}),m("playMovie",{n:i})};e("body").on("click","[name=poster_box]",function(e){return e.preventDefault(),e.stopPropagation(),K(this),!1}).on("click","[name=unlike]",function(t){t.preventDefault(),t.stopPropagation();var n=e(this).parents("[name=item]"),o=n.attr("data-movieno");if(o){var a=localStorage.getItem("like");a=a?JSON.parse(a):[],a.push(o),localStorage.setItem("like",JSON.stringify(a)),e(this).attr("name","like").find("i").removeClass("far").addClass("fas"),m("likeMovie",{n:o})}return!1}).on("click","[name=like]",function(t){t.preventDefault(),t.stopPropagation();var n=e(this).parents("[name=item]"),o=n.attr("data-movieno");if(o){var a=localStorage.getItem("like"),i=(a=a?JSON.parse(a):[],a.indexOf(o));i>-1&&a.splice(i,1),localStorage.setItem("like",JSON.stringify(a)),e(this).attr("name","unlike").find("i").removeClass("fas").addClass("far"),m("unlikeMovie",{n:o})}return!1}).on("click","[name=delete]",function(t){t.preventDefault(),t.stopPropagation();var n=e(this).parents("[name=item]"),o=n.attr("data-movieno");return o&&(n.hide(),m("deleteMovie",{n:o,c:d()},function(e){e&&e.success?e.payload&&n.hide():n.show()})),!1}).on("click","[name=close], .popup_bg",function(t){return P=!0,$=!0,t.preventDefault(),t.stopPropagation(),e("main").height("auto").css({overflow:"auto","margin-top":"0"}),e(document).scrollTop(E),e(".popup_bg").addClass("d-none"),e(".popup_movie").remove(),clearTimeout(window._autoplay),!1}),e("#btn-more").on("click",function(){B()}),setTimeout(function(){e(window).scroll(function(){L(),z(),J()}).resize(function(){L()})},2e3);var R=function(t,n){e.post(r+"/search/",{s:t,t:n},function(t){if(t&&t.success){for(i in li=[],t.payload){var n=t.payload[i];li.push("<li>"+n.name+"</li>")}e(".autocomplete").empty().append(li.join(""))}},"json")};e("input[name=search]").on("keyup",function(){var t=e.trim(e('[name="search-type"]').val()),n=e.trim(e(this).val());n.length<1||R(n,t)}),e("form[name=search]").on("submit",function(){let t=e('[name="search-type"]').val(),n=e("input[name=search]").val();return"category"==t&&(window.location.href="#"+n),"date"==t&&(window.location.href=_("date",n)+window.location.hash),e(".autocomplete").empty(),e("input[name=search]").val(""),!1}),e("button[name=button-search]").on("click",function(){return e("input[name=search]").keyup(),!1}),e("form[name=search]").on("click",function(){e(".autocomplete").empty()}),e(".autocomplete").on("click","li",function(){let t=e('[name="search-type"]').val(),n=e(this).text();if("category"==t){if(n==d())return!1;location.href="#"+n,D(),e(".autocomplete").empty(),e("input[name=search]").val(""),e("[name=btn-menu-toggler]:visible").click()}else window.location.href=_("date",n)+window.location.hash}),e("[name=form-signin]").on("submit",function(){return v(),!1}),e("[name=form-addparser]").on("submit",function(){return g(),!1}),e("[name=form-addvideo]").on("submit",function(){return h(),!1}),e("[name=btn-login],[name=btn-logout],[name=btn-join]").on("click",function(){e("[name=btn-menu-toggler]:visible").click()}),e("form[name=search]").on("submit",function(){e("[name=btn-menu-toggler]:visible").click()}),e("[name=btn-menu-toggler]").on("click",function(){setTimeout(function(){e("[name=search]").focus()},1e3)}),e('[name="btn-today"]').on("click",function(){return window.location.href="?date="+date("Y-m-d")+window.location.hash,!1}),e('[name="btn-yesterday"]').on("click",function(){return window.location.href="?date="+date("Y-m-d",strtotime("-1 day"))+window.location.hash,!1}),e('[name="btn-before-yesterday"]').on("click",function(){return window.location.href="?date="+date("Y-m-d",strtotime("-2 day"))+window.location.hash,!1}),e('[name="btn-before-total"]').on("click",function(){return window.location.href="?"+window.location.hash,!1}),e("[name=youtube_url]").on("change",function(){const t=e("[name=youtube_url]").val();if(t.indexOf("youtube.com")){const n=b(t);console.log(n),n.id&&(e('[name="title"]').val(n.title),e('[name="categories"]').val(n.author_name),e('[name="movie_url"]').val(n.movie_url),e('[name="regdate"]').val(date("Y-m-d H:i:s")),e('[name="poster_url"]').val(n.poster_url),e('[name="free"]').val("Y"))}})})(jQuery);