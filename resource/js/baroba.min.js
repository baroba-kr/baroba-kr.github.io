(function(e){var t=[],n={},o=!1,a=window.location.host?"web":process.versions.electron?"pc":"mobile",l=(window.location.host&&window.location.host,"//api."+window.location.host),s="",r=function(){s=setTimeout(r,300),t&&t.length>0&&(e.post(l+"/request/?",{item:JSON.stringify(t)},function(t){for(i in t.payload){var n=t.payload[i],o="cb_"+n.method;window[o]&&window[o](e.parseJSON(n.data))}},"json"),t=[])},c=function(e,n,o){var a={method:e,params:n},l="cb_"+e;for(i in t)if(t[i].method==e)return;t.push(a),window[l]=o},m=function(){const e=decodeURIComponent(window.location.hash)+"";return e?e.substr(1):""},d=function(e){var t;return t=e.indexOf("//")>-1?e.split("/")[2]:e.split("/")[0],t=t.split(":")[0],t=t.split("?")[0],t},u=function(e){var t=d(e),n=t.split("."),o=n.length;return o>2&&(t=n[o-2]+"."+n[o-1],2==n[o-2].length&&2==n[o-1].length&&(t=n[o-3]+"."+t)),t=t.split("."),t[0]},p=function(){return c("login",{userid:e("[name=userid]").val(),userpw:e("[name=userpw]").val()},function(t){if(t&&t.success&&t.payload)e("[name=btn-login],[name=btn-join]").addClass("d-none"),e("[name=btn-logout]").removeClass("d-none"),sessionStorage.delete_movie=t.payload.delete_movie,location.href="#";else{var n=t.error&&t.error.message?t.error.message:"로그인 정보가 올바른지 확인해주세요.";alert(n)}}),!1},f=function(){return c("addParser",{url:e("[name=url]").val(),category:e("[name=category]").val(),active:e("[name=active]").val(),free:e("[name=free]").val(),adult:e("[name=adult]").val(),interval:e("[name=interval]").val(),site_no:e("[name=site_no]").val(),interval:e("[name=interval]").val(),ordinal:e("[name=ordinal]").val()},function(t){if(t&&t.success&&t.payload)e("[name=btn-login],[name=btn-join]").addClass("d-none"),e("[name=btn-logout]").removeClass("d-none"),sessionStorage.delete_movie=t.payload.delete_movie,location.href="#";else{var n=t.error&&t.error.message?t.error.message:"로그인 정보가 올바른지 확인해주세요.";alert(n)}}),!1},g=function(e){var t=window.location.search.substring(1),n=t.split("&");let o="";if(e=(e+"").trim(),!e)return o;e+="=";for(var a=0;a<n.length;a++){let t=n[a],i=t.indexOf(e);if(i>-1){o=t.substr(i+e.length);break}}return o},v=function(e,t,n){let o=n||window.location.search,a=(o.indexOf("?")>-1?o.substring(o.indexOf("?")+1).length:o.length,o.split("?",2));return o=o.indexOf(e+"=")>-1?o.replace(new RegExp(e+"=(.[^&]*)?(&|)","g"),e+"="+t+"$2",o):a[1]?o+"&"+e+"="+t:a[0]+"?"+e+"="+t,o},h=40;r(),sessionStorage.delete_movie=sessionStorage.delete_movie?sessionStorage.delete_movie:"N",e(window).blur(function(){s=clearTimeout(s)}),e(window).focus(function(){s||r()});var w=0,b=function(){var t=e("[name=poster_box]:last").width(),n=9*t/16,o=200;if(t>0&&w!=t){w=t;var a="[name=poster_box]{height:"+n+"px;}",i=e("style[name=poster_box_style]");i.length>0?i.empty().append(a):e("head").append('<style name="poster_box_style">'+a+"</style>")}else o=1e3;setTimeout(function(){b()},o)},y=!0,_=function(e){var t='<div name="item" data-movie="{movieurl}" data-movieno="{movieno}" data-time="{time}" class="item">            <!-- <a href="#" class="poster_box_link"><div name="poster_box" style="background-image:url(resource/image/no-img.png);display:block" data-src="{posterurl}" class=" btn m-0 p-0 blazyload"></div></a>-->            <a href="#" class="poster_box_link"><div name="poster_box" style="background-image:url({posterurl});display:block" data-src="{posterurl}" class=" btn m-0 p-0 "></div></a>            <p name="ctrl">                <span class="text-muted">                    {root_domain}                     {date}                </span>                <span name="icon" class="float-right">                    <a href="#" name="{like_name}"><i class="{like_class} fa-heart d-none"></i></a>&nbsp;                    <a href="#" name="delete" class="{hide_delete_btn}"><i class="fas fa-trash-alt"></i></a>                    <a href="#" name="share"><i class="fas fa-share-alt d-none"></i></a>&nbsp;                    <a href="#" name="close" class="d-none"><i class="fas fa-times"></i></a>&nbsp;                </span>            </p>            <p name="title">                {title}             </p>        </div>',o=[],a=localStorage.getItem("like");for(i in e){var l=e[i],s=l.time,r=new Date(1e3*s),c=r.getMonth()+1,m=r.getDate()<10?"0"+r.getDate():r.getDate(),d=r.getHours()<10?"0"+r.getHours():r.getHours(),p=r.getMinutes()<10?"0"+r.getMinutes():r.getMinutes(),f=c+"."+m+" "+d+":"+p,g=l.poster?l.poster:"resource/image/no-img.png",v=a?a.indexOf(l.movie_no):-1,h=v<0?"unlike":"like",w=v<0?"far":"fas";void 0===n[l.movie_no]&&(o.push(t.replace(/{posterurl}/g,g).replace(/{movieurl}/g,l.url).replace(/{time}/g,l.time).replace(/{movieno}/g,l.movie_no).replace(/{title}/g,l.title).replace(/{date}/g,f).replace(/{root_domain}/g,u(l.url).toUpperCase()).replace(/{like_name}/g,h).replace(/{like_class}/g,w).replace("{hide_delete_btn}","Y"==sessionStorage.delete_movie?"":"d-none")),n[l.movie_no]=!0,setTimeout(function(){Y()},1e3))}return o},k=null,T=function(t){if(t&&t.success){var n=e("[name=item]").length;e("#searching").addClass("d-none"),(!t.payload||t.payload&&t.payload.length<1)&&(e("#btn-more").addClass("d-none"),e("[name=item]").length<1&&e("#empty-result").removeClass("d-none")),e("#empty-result").addClass("d-none");var o=e("#list"),a=_(t.payload);o.append(a.join("")),b(),y?(y=!1,search_date=g("date"),k=e("[name=item]:eq(0)"),c("getMovieList",{c:m(),cnt:h,time:k.attr("data-time"),date:search_date,direction:"back"},C)):k=null,"Y"==sessionStorage.delete_movie&&e("[name=delete].d-none").removeClass("d-none"),t.payload&&t.payload.length<h?e("#btn-more").addClass("d-none"):e("#btn-more").removeClass("d-none").attr("data-time",e("[name=item]:last").attr("data-time")),n<1&&(e(window).scrollTop(0),H=H,setTimeout(function(){H=!1,H=!0},1e3)),D=!0}},C=function(t){if(t&&t.success){if(t.payload&&!(t.payload&&t.payload.length<1)){var n=e("#list"),o=_(t.payload);n.prepend(o.join("")),b(),"Y"==sessionStorage.delete_movie&&e("[name=delete].d-none").removeClass("d-none"),k&&(e(window).scrollTop(k.offset().top-70),k=null),I=!0}}else k=null},M=function(){e("#list").empty(),n={}},x=(t,n)=>{console.log(t,e('footer a[href="#'+t+'"]').length,e('footer a[href="#'+t+'"]').length<1),e('footer a[href="#'+t+'"]').length<1&&(n&&(S.push(t),S=S.filter((e,t,n)=>n.indexOf(e)===t&&e),localStorage.setItem("tabKeywords",S)),e("footer > div").append('<a href="#'+t+'"><div>'+t+"</div></a>"))},S=(localStorage.getItem("tabKeywords")||"").split(",");for(i in e("footer > div > *").each(function(){S.push(e(this).attr("href").replace("#",""))}),S=S.filter((e,t,n)=>n.indexOf(e)===t&&e),console.log(S),S)x(S[i]);var O={},j=function(){e(document).focus();var t=m();switch(e(".board").addClass("d-none"),t){case"login":e("[name=login]").removeClass("d-none");break;case"logout":c("logout",{},function(){sessionStorage.delete_movie="N",e("[name=btn-login],[name=btn-join]").removeClass("d-none"),e("[name=btn-logout]").addClass("d-none"),window.location.href="#"});break;case"join":e("[name=join]").removeClass("d-none");break;case"addparser":o&&e("[name=addparser]").removeClass("d-none");break;default:if(M(),document.title="BAROBA - "+t,e("#searching").removeClass("d-none"),e("[name=main]").removeClass("d-none"),e("#btn-more").addClass("d-none"),lastMovieTime=localStorage.getItem("lastMovieTime"),lastMovieTime=lastMovieTime?JSON.parse(lastMovieTime):{},lastMovieTime[t]&&(O[t]||(O[t]=!0,lastMovieTime[t]<Math.floor((new Date).getTime()/1e3)+86400&&(lastMovieTime[t]=!1))),!lastMovieTime[t]){let e=new Date,n=e.getHours()<6?new Date(e.getFullYear(),e.getMonth(),e.getDate()-1,0,0,0,0):new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0);lastMovieTime[t]=Math.floor(n.getTime()/1e3),localStorage.setItem("lastMovieTime",JSON.stringify(lastMovieTime))}search_date=g("date"),console.log("search_date:",search_date),c("getMovieList",{c:t,cnt:h,time:lastMovieTime[t],date:search_date},T),x(t,!0)}};c("isLogin",{},function(t){t&&t.success&&t.payload?(o=t.payload,e("[name=btn-login],[name=btn-join]").addClass("d-none"),e("[name=btn-logout]").removeClass("d-none")):(e("[name=btn-login],[name=btn-join]").removeClass("d-none"),e("[name=btn-logout]").addClass("d-none"))});var D=!0,I=!0,N=1e3,J=800,P=function(){e(window).scrollTop()<=N&&I&&(search_date=g("date"),I=!1,c("getMovieList",{c:m(),cnt:h,time:e("[name=item]:eq(0)").attr("data-time"),date:search_date,direction:"back"},C))},L=function(){e(window).scrollTop()+e(window).height()>=e(document).height()-J&&e("#btn-more").is(":visible")&&D&&e("#btn-more").click()},H=!0,Y=function(){if(H){var t=e(window),n=e("[name=item]"),o=Math.floor(t.width()/n.width()),a=(o=o>5?5:o,Math.floor(t.scrollTop()/(n.height()+20))*o),i=n.eq(a).attr("data-time"),l=localStorage.getItem("lastMovieTime"),s=(l=l?JSON.parse(l):{},m());s=s||"";i&&(l[s]=i),localStorage.setItem("lastMovieTime",JSON.stringify(l))}},q=function(){D=!1,c("getMovieList",{time:e("[name=item]:last").attr("data-time"),c:m(),cnt:h},T)};j(),window.addEventListener("hashchange",function(e){y=!0,j()});var B=0,R=function(t){I=!1,D=!1;e(window).outerWidth();var n=e(t).parents("[name=item]"),o=n.attr("data-movie"),i=(o=window.location.href.indexOf("https://")>-1&&o.indexOf("mgoon.com")>-1?o.replace("http://","https://"):o,n.attr("data-movieno")),l=o.match(/\.gif/i)?"image":"video",s=n.find("[name=ctrl]"),r=n.find("[name=title]"),m=e("image"==l?'<img class=" arve-iframe fitvidsignore" name="movie" src="'+o+'" width="100%" height="auto">':'<iframe class="popup_movie arve-iframe fitvidsignore" frameborder="0" name="movie" scrolling="no" src="'+o+'" width="100%" height="auto" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture; fullscreen" allowfullscreen></iframe>');e(".popup_movie").remove(),e(".preloader").removeClass("d-none"),e("[name=movie_area]").html(m),e("[name=ctrlbox]").html(s.html()).find("[name=close]").removeClass("d-none"),e("[name=titlebox]").html(r.html()),B=e(document).scrollTop(),e("main").height("auto").css({overflow:"auto"}),e("main").height(e(window).innerHeight()-56-20+B).css({overflow:"hidden","margin-top":-1*B}),e(".popup_bg").removeClass("d-none"),"video"==l&&m.height(9*m.width()/16),m.on("load",function(){if(e(".preloader").addClass("d-none"),"web"!=a){var t=200;if(o.indexOf("naver.com")>-1){var n=function(e){m.contents().find(".u_rmc_btn_skip").length>0?(m.contents().find(".u_rmc_btn_skip").click(),window._autoplay=setTimeout(function(){n(e)},e)):clearTimeout(window._autoplay)},i=function(e){m.contents().find(".u_rmc_navertv_ic").length>0?(m.contents().find(".u_rmc_navertv_ic").click(),n(e)):window._autoplay=setTimeout(function(){i(e)},e)};window._autoplay=setTimeout(function(){i(t)},t)}else if(o.indexOf("streamango.com")>-1){i=function(e){m.contents().find(".vjs-big-play-button").length>0?(m.contents().find(".vjs-big-play-button").click(),clearTimeout(window._autoplay)):window._autoplay=setTimeout(function(){i(e)},e)};window._autoplay=setTimeout(function(){i(t)},t)}else if(o.indexOf("dailymotion.com")>-1){i=function(e){m.contents().find(".np_ButtonPlayback").length>0?(m.contents().find(".np_ButtonPlayback").click(),clearTimeout(window._autoplay)):window._autoplay=setTimeout(function(){i(e)},e)};window._autoplay=setTimeout(function(){i(t)},t)}else if(o.indexOf("youtube.com")>-1){i=function(e){m.contents().find(".ytp-large-play-button").length>0?(m.contents().find(".ytp-large-play-button").click(),clearTimeout(window._autoplay)):window._autoplay=setTimeout(function(){i(e)},e)};window._autoplay=setTimeout(function(){i(t)},t)}else{i=function(e){m.contents().find("button").length>0?(m.contents().find("button").click(),clearTimeout(window._autoplay)):window._autoplay=setTimeout(function(){i(e)},e)};window._autoplay=setTimeout(function(){i(t)},t)}}}),c("playMovie",{n:i})};e("body").on("click","[name=poster_box]",function(e){return e.preventDefault(),e.stopPropagation(),R(this),!1}).on("click","[name=unlike]",function(t){t.preventDefault(),t.stopPropagation();var n=e(this).parents("[name=item]"),o=n.attr("data-movieno");if(o){var a=localStorage.getItem("like");a=a?JSON.parse(a):[],a.push(o),localStorage.setItem("like",JSON.stringify(a)),e(this).attr("name","like").find("i").removeClass("far").addClass("fas"),c("likeMovie",{n:o})}return!1}).on("click","[name=like]",function(t){t.preventDefault(),t.stopPropagation();var n=e(this).parents("[name=item]"),o=n.attr("data-movieno");if(o){var a=localStorage.getItem("like"),i=(a=a?JSON.parse(a):[],a.indexOf(o));i>-1&&a.splice(i,1),localStorage.setItem("like",JSON.stringify(a)),e(this).attr("name","unlike").find("i").removeClass("fas").addClass("far"),c("unlikeMovie",{n:o})}return!1}).on("click","[name=delete]",function(t){t.preventDefault(),t.stopPropagation();var n=e(this).parents("[name=item]"),o=n.attr("data-movieno");return o&&(n.hide(),c("deleteMovie",{n:o,c:m()},function(e){e&&e.success?e.payload&&n.hide():n.show()})),!1}).on("click","[name=close], .popup_bg",function(t){return D=!0,I=!0,t.preventDefault(),t.stopPropagation(),e("main").height("auto").css({overflow:"auto","margin-top":"0"}),e(document).scrollTop(B),e(".popup_bg").addClass("d-none"),e(".popup_movie").remove(),clearTimeout(window._autoplay),!1}),e("#btn-more").on("click",function(){q()}),setTimeout(function(){e(window).scroll(function(){L(),Y(),P()}).resize(function(){L()})},2e3);var z=function(t,n){e.post(l+"/search/",{s:t,t:n},function(t){if(t&&t.success){for(i in li=[],t.payload){var n=t.payload[i];li.push("<li>"+n.name+"</li>")}e(".autocomplete").empty().append(li.join(""))}},"json")};e("input[name=search]").on("keyup",function(){var t=e.trim(e('select[name="search-type"]').val()),n=e.trim(e(this).val());n.length<1||z(n,t)}),e("form[name=search]").on("submit",function(){let t=e('select[name="search-type"]').val(),n=e("input[name=search]").val();return"category"==t&&(window.location.href="#"+n),"date"==t&&(window.location.href=v("date",n)+window.location.hash),e(".autocomplete").empty(),e("input[name=search]").val(""),!1}),e("button[name=button-search]").on("click",function(){return e("input[name=search]").keyup(),!1}),e("form[name=search]").on("click",function(){e(".autocomplete").empty()}),e(".autocomplete").on("click","li",function(){let t=e('select[name="search-type"]').val(),n=e(this).text();if("category"==t){if(n==m())return!1;location.href="#"+n,M(),e(".autocomplete").empty(),e("input[name=search]").val(""),e("[name=btn-menu-toggler]:visible").click()}else window.location.href=v("date",n)+window.location.hash}),e("[name=form-signin]").on("submit",function(){return p(),!1}),e("[name=form-addparser]").on("submit",function(){return f(),!1}),e("[name=btn-login],[name=btn-logout],[name=btn-join]").on("click",function(){e("[name=btn-menu-toggler]:visible").click()}),e("form[name=search]").on("submit",function(){e("[name=btn-menu-toggler]:visible").click()}),e("[name=btn-menu-toggler]").on("click",function(){setTimeout(function(){e("[name=search]").focus()},1e3)})})(jQuery);