(function(e){var t=[],n={},o=!1,a=window.location.host?"web":process.versions.electron?"pc":"mobile",l=window.location.host?"//"+window.location.host:"//www.baroba.kr",s=l.replace("www.","").replace("//","//api."),r="",c=function(){r=setTimeout(c,300),t&&t.length>0&&(e.post(s+"/request/?",{item:JSON.stringify(t)},function(t){for(i in t.payload){var n=t.payload[i],o="cb_"+n.method;window[o]&&window[o](e.parseJSON(n.data))}},"json"),t=[])},m=function(e,n,o){var a={method:e,params:n},l="cb_"+e;for(i in t)if(t[i].method==e)return;t.push(a),window[l]=o},d=function(){const e=decodeURIComponent(window.location.hash)+"";return e?e.substr(1):""},u=function(e){var t;return t=e.indexOf("//")>-1?e.split("/")[2]:e.split("/")[0],t=t.split(":")[0],t=t.split("?")[0],t},p=function(e){var t=u(e),n=t.split("."),o=n.length;return o>2&&(t=n[o-2]+"."+n[o-1],2==n[o-2].length&&2==n[o-1].length&&(t=n[o-3]+"."+t)),t=t.split("."),t[0]},f=function(){return m("login",{userid:e("[name=userid]").val(),userpw:e("[name=userpw]").val()},function(t){if(t&&t.success&&t.payload)e("[name=btn-login],[name=btn-join]").addClass("d-none"),e("[name=btn-logout]").removeClass("d-none"),sessionStorage.delete_movie=t.payload.delete_movie,location.href="#";else{var n=t.error&&t.error.message?t.error.message:"로그인 정보가 올바른지 확인해주세요.";alert(n)}}),!1},g=function(){return m("addParser",{url:e("[name=url]").val(),category:e("[name=category]").val(),active:e("[name=active]").val(),free:e("[name=free]").val(),adult:e("[name=adult]").val(),interval:e("[name=interval]").val(),site_no:e("[name=site_no]").val(),interval:e("[name=interval]").val(),ordinal:e("[name=ordinal]").val()},function(t){if(t&&t.success&&t.payload)e("[name=btn-login],[name=btn-join]").addClass("d-none"),e("[name=btn-logout]").removeClass("d-none"),sessionStorage.delete_movie=t.payload.delete_movie,location.href="#";else{var n=t.error&&t.error.message?t.error.message:"로그인 정보가 올바른지 확인해주세요.";alert(n)}}),!1},v=function(e){var t=window.location.search.substring(1),n=t.split("&");let o="";if(e=(e+"").trim(),!e)return o;e+="=";for(var a=0;a<n.length;a++){let t=n[a],i=t.indexOf(e);if(i>-1){o=t.substr(i+e.length);break}}return o},h=function(e,t,n){let o=n||window.location.search,a=(o.indexOf("?")>-1?o.substring(o.indexOf("?")+1).length:o.length,o.split("?",2));return o=o.indexOf(e+"=")>-1?o.replace(new RegExp(e+"=(.[^&]*)?(&|)","g"),e+"="+t+"$2",o):a[1]?o+"&"+e+"="+t:a[0]+"?"+e+"="+t,o},w=40;c(),sessionStorage.delete_movie=sessionStorage.delete_movie?sessionStorage.delete_movie:"N",e(window).blur(function(){r=clearTimeout(r)}),e(window).focus(function(){r||c()});var b=0,_=function(){var t=e("[name=poster_box]:last").width(),n=9*t/16,o=200;if(t>0&&b!=t){b=t;var a="[name=poster_box]{height:"+n+"px;}",i=e("style[name=poster_box_style]");i.length>0?i.empty().append(a):e("head").append('<style name="poster_box_style">'+a+"</style>")}else o=1e3;setTimeout(function(){_()},o)},y=!0,k=function(e){var t='<div name="item" data-movie="{movieurl}" data-movieno="{movieno}" data-time="{time}" class="item">            <!-- <a href="#" class="poster_box_link"><div name="poster_box" style="background-image:url(resource/image/no-img.png);display:block" data-src="{posterurl}" class=" btn m-0 p-0 blazyload"></div></a>-->            <a href="#" class="poster_box_link"><div name="poster_box" style="background-image:url({posterurl});display:block" data-src="{posterurl}" class=" btn m-0 p-0 "></div></a>            <p name="ctrl">                <span class="text-muted">                    {root_domain}                     {date}                </span>                <span name="icon" class="float-right">                    <a href="#" name="{like_name}"><i class="{like_class} fa-heart d-none"></i></a>&nbsp;                    <a href="#" name="delete" class="{hide_delete_btn}"><i class="fas fa-trash-alt"></i></a>                    <a href="#" name="share"><i class="fas fa-share-alt d-none"></i></a>&nbsp;                    <a href="#" name="close" class="d-none"><i class="fas fa-times"></i></a>&nbsp;                </span>            </p>            <p name="title">                {title}             </p>        </div>',o=[],a=localStorage.getItem("like");for(i in e){var l=e[i],s=l.time,r=new Date(1e3*s),c=r.getMonth()+1,m=r.getDate()<10?"0"+r.getDate():r.getDate(),d=r.getHours()<10?"0"+r.getHours():r.getHours(),u=r.getMinutes()<10?"0"+r.getMinutes():r.getMinutes(),f=c+"."+m+" "+d+":"+u,g=l.poster?l.poster:"resource/image/no-img.png",v=a?a.indexOf(l.movie_no):-1,h=v<0?"unlike":"like",w=v<0?"far":"fas";void 0===n[l.movie_no]&&(o.push(t.replace(/{posterurl}/g,g).replace(/{movieurl}/g,l.url).replace(/{time}/g,l.time).replace(/{movieno}/g,l.movie_no).replace(/{title}/g,l.title).replace(/{date}/g,f).replace(/{root_domain}/g,p(l.url).toUpperCase()).replace(/{like_name}/g,h).replace(/{like_class}/g,w).replace("{hide_delete_btn}","Y"==sessionStorage.delete_movie?"":"d-none")),n[l.movie_no]=!0,setTimeout(function(){q()},1e3))}return o},T=null,C=function(t){if(t&&t.success){var n=e("[name=item]").length;e("#searching").addClass("d-none"),(!t.payload||t.payload&&t.payload.length<1)&&(e("#btn-more").addClass("d-none"),e("[name=item]").length<1&&e("#empty-result").removeClass("d-none")),e("#empty-result").addClass("d-none");var o=e("#list"),a=k(t.payload);o.append(a.join("")),_(),y?(y=!1,search_date=v("date"),T=e("[name=item]:eq(0)"),m("getMovieList",{c:d(),cnt:w,time:T.attr("data-time"),date:search_date,direction:"back"},x)):T=null,"Y"==sessionStorage.delete_movie&&e("[name=delete].d-none").removeClass("d-none"),t.payload&&t.payload.length<w?e("#btn-more").addClass("d-none"):e("#btn-more").removeClass("d-none").attr("data-time",e("[name=item]:last").attr("data-time")),n<1&&(e(window).scrollTop(0),Y=Y,setTimeout(function(){Y=!1,Y=!0},1e3)),I=!0}},x=function(t){if(t&&t.success){if(t.payload&&!(t.payload&&t.payload.length<1)){var n=e("#list"),o=k(t.payload);n.prepend(o.join("")),_(),"Y"==sessionStorage.delete_movie&&e("[name=delete].d-none").removeClass("d-none"),T&&(e(window).scrollTop(T.offset().top-70),T=null),N=!0}}else T=null},M=function(){e("#list").empty(),n={}},S=(t,n)=>{console.log(t,e('footer a[href="#'+t+'"]').length,e('footer a[href="#'+t+'"]').length<1),e('footer a[href="#'+t+'"]').length<1&&(n&&(O.push(t),O=O.filter((e,t,n)=>n.indexOf(e)===t&&e),localStorage.setItem("tabKeywords",O)),e("footer > div").append('<a href="#'+t+'"><div>'+t+"</div></a>"))},O=(localStorage.getItem("tabKeywords")||"").split(",");for(i in e("footer > div > *").each(function(){O.push(e(this).attr("href").replace("#",""))}),O=O.filter((e,t,n)=>n.indexOf(e)===t&&e),console.log(O),O)S(O[i]);var j={},D=function(){e(document).focus();var t=d();switch(e(".board").addClass("d-none"),t){case"login":e("[name=login]").removeClass("d-none");break;case"logout":m("logout",{},function(){sessionStorage.delete_movie="N",e("[name=btn-login],[name=btn-join]").removeClass("d-none"),e("[name=btn-logout]").addClass("d-none"),window.location.href="#"});break;case"join":e("[name=join]").removeClass("d-none");break;case"addparser":o&&e("[name=addparser]").removeClass("d-none");break;default:if(M(),t){let e=document.title+"";e=e.indexOf(" - ")>-1?e.substring(0,e.indexOf(" - ")):e,document.title=e+" - "+t}if(e("#searching").removeClass("d-none"),e("[name=main]").removeClass("d-none"),e("#btn-more").addClass("d-none"),lastMovieTime=localStorage[t],lastMovieTime&&(j[t]||(j[t]=!0,lastMovieTime<Math.floor((new Date).getTime()/1e3)+86400&&(lastMovieTime=!1))),!lastMovieTime){let e=new Date,n=e.getHours()<6?new Date(e.getFullYear(),e.getMonth(),e.getDate()-1,0,0,0,0):new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0);lastMovieTime=Math.floor(n.getTime()/1e3),localStorage.setItem(t,lastMovieTime)}search_date=v("date"),console.log("search_date:",search_date),m("getMovieList",{c:t,cnt:w,time:lastMovieTime,date:search_date},C),S(t,!0)}};m("isLogin",{},function(t){t&&t.success&&t.payload?(o=t.payload,e("[name=btn-login],[name=btn-join]").addClass("d-none"),e("[name=btn-logout]").removeClass("d-none")):(e("[name=btn-login],[name=btn-join]").removeClass("d-none"),e("[name=btn-logout]").addClass("d-none"))});var I=!0,N=!0,P=1e3,J=800,L=function(){e(window).scrollTop()<=P&&N&&(search_date=v("date"),N=!1,m("getMovieList",{c:d(),cnt:w,time:e("[name=item]:eq(0)").attr("data-time"),date:search_date,direction:"back"},x))},H=function(){e(window).scrollTop()+e(window).height()>=e(document).height()-J&&e("#btn-more").is(":visible")&&I&&e("#btn-more").click()},Y=!0,q=function(){if(Y){var t=e(window),n=e("[name=item]"),o=Math.floor(t.width()/n.width()),a=(o=o>5?5:o,Math.floor(t.scrollTop()/(n.height()+20))*o),i=n.eq(a).attr("data-time"),l=d();l=l||"";i&&localStorage.setItem(l,i)}},z=function(){I=!1,m("getMovieList",{time:e("[name=item]:last").attr("data-time"),c:d(),cnt:w},C)};D(),window.addEventListener("hashchange",function(e){y=!0,D()});var B=0,E=function(t){N=!1,I=!1;e(window).outerWidth();var n=e(t).parents("[name=item]"),o=n.attr("data-movie"),i=(o=window.location.href.indexOf("https://")>-1&&o.indexOf("mgoon.com")>-1?o.replace("http://","https://"):o,n.attr("data-movieno")),l=o.match(/\.gif/i)?"image":"video",s=n.find("[name=ctrl]"),r=n.find("[name=title]"),c=e("image"==l?'<img class=" arve-iframe fitvidsignore" name="movie" src="'+o+'" width="100%" height="auto">':'<iframe class="popup_movie arve-iframe fitvidsignore" frameborder="0" name="movie" scrolling="no" src="'+o+'" width="100%" height="auto" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture; fullscreen" allowfullscreen></iframe>');e(".popup_movie").remove(),e(".preloader").removeClass("d-none"),e("[name=movie_area]").html(c),e("[name=ctrlbox]").html(s.html()).find("[name=close]").removeClass("d-none"),e("[name=titlebox]").html(r.html()),B=e(document).scrollTop(),e("main").height("auto").css({overflow:"auto"}),e("main").height(e(window).innerHeight()-56-20+B).css({overflow:"hidden","margin-top":-1*B}),e(".popup_bg").removeClass("d-none"),"video"==l&&c.height(9*c.width()/16),c.on("load",function(){if(e(".preloader").addClass("d-none"),"web"!=a){var t=200;if(o.indexOf("naver.com")>-1){var n=function(e){c.contents().find(".u_rmc_btn_skip").length>0?(c.contents().find(".u_rmc_btn_skip").click(),window._autoplay=setTimeout(function(){n(e)},e)):clearTimeout(window._autoplay)},i=function(e){c.contents().find(".u_rmc_navertv_ic").length>0?(c.contents().find(".u_rmc_navertv_ic").click(),n(e)):window._autoplay=setTimeout(function(){i(e)},e)};window._autoplay=setTimeout(function(){i(t)},t)}else if(o.indexOf("streamango.com")>-1){i=function(e){c.contents().find(".vjs-big-play-button").length>0?(c.contents().find(".vjs-big-play-button").click(),clearTimeout(window._autoplay)):window._autoplay=setTimeout(function(){i(e)},e)};window._autoplay=setTimeout(function(){i(t)},t)}else if(o.indexOf("dailymotion.com")>-1){i=function(e){c.contents().find(".np_ButtonPlayback").length>0?(c.contents().find(".np_ButtonPlayback").click(),clearTimeout(window._autoplay)):window._autoplay=setTimeout(function(){i(e)},e)};window._autoplay=setTimeout(function(){i(t)},t)}else if(o.indexOf("youtube.com")>-1){i=function(e){c.contents().find(".ytp-large-play-button").length>0?(c.contents().find(".ytp-large-play-button").click(),clearTimeout(window._autoplay)):window._autoplay=setTimeout(function(){i(e)},e)};window._autoplay=setTimeout(function(){i(t)},t)}else{i=function(e){c.contents().find("button").length>0?(c.contents().find("button").click(),clearTimeout(window._autoplay)):window._autoplay=setTimeout(function(){i(e)},e)};window._autoplay=setTimeout(function(){i(t)},t)}}}),m("playMovie",{n:i})};e("body").on("click","[name=poster_box]",function(e){return e.preventDefault(),e.stopPropagation(),E(this),!1}).on("click","[name=unlike]",function(t){t.preventDefault(),t.stopPropagation();var n=e(this).parents("[name=item]"),o=n.attr("data-movieno");if(o){var a=localStorage.getItem("like");a=a?JSON.parse(a):[],a.push(o),localStorage.setItem("like",JSON.stringify(a)),e(this).attr("name","like").find("i").removeClass("far").addClass("fas"),m("likeMovie",{n:o})}return!1}).on("click","[name=like]",function(t){t.preventDefault(),t.stopPropagation();var n=e(this).parents("[name=item]"),o=n.attr("data-movieno");if(o){var a=localStorage.getItem("like"),i=(a=a?JSON.parse(a):[],a.indexOf(o));i>-1&&a.splice(i,1),localStorage.setItem("like",JSON.stringify(a)),e(this).attr("name","unlike").find("i").removeClass("fas").addClass("far"),m("unlikeMovie",{n:o})}return!1}).on("click","[name=delete]",function(t){t.preventDefault(),t.stopPropagation();var n=e(this).parents("[name=item]"),o=n.attr("data-movieno");return o&&(n.hide(),m("deleteMovie",{n:o,c:d()},function(e){e&&e.success?e.payload&&n.hide():n.show()})),!1}).on("click","[name=close], .popup_bg",function(t){return I=!0,N=!0,t.preventDefault(),t.stopPropagation(),e("main").height("auto").css({overflow:"auto","margin-top":"0"}),e(document).scrollTop(B),e(".popup_bg").addClass("d-none"),e(".popup_movie").remove(),clearTimeout(window._autoplay),!1}),e("#btn-more").on("click",function(){z()}),setTimeout(function(){e(window).scroll(function(){H(),q(),L()}).resize(function(){H()})},2e3);var F=function(t,n){e.post(s+"/search/",{s:t,t:n},function(t){if(t&&t.success){for(i in li=[],t.payload){var n=t.payload[i];li.push("<li>"+n.name+"</li>")}e(".autocomplete").empty().append(li.join(""))}},"json")};e("input[name=search]").on("keyup",function(){var t=e.trim(e('select[name="search-type"]').val()),n=e.trim(e(this).val());n.length<1||F(n,t)}),e("form[name=search]").on("submit",function(){let t=e('select[name="search-type"]').val(),n=e("input[name=search]").val();return"category"==t&&(window.location.href="#"+n),"date"==t&&(window.location.href=h("date",n)+window.location.hash),e(".autocomplete").empty(),e("input[name=search]").val(""),!1}),e("button[name=button-search]").on("click",function(){return e("input[name=search]").keyup(),!1}),e("form[name=search]").on("click",function(){e(".autocomplete").empty()}),e(".autocomplete").on("click","li",function(){let t=e('select[name="search-type"]').val(),n=e(this).text();if("category"==t){if(n==d())return!1;location.href="#"+n,M(),e(".autocomplete").empty(),e("input[name=search]").val(""),e("[name=btn-menu-toggler]:visible").click()}else window.location.href=h("date",n)+window.location.hash}),e("[name=form-signin]").on("submit",function(){return f(),!1}),e("[name=form-addparser]").on("submit",function(){return g(),!1}),e("[name=btn-login],[name=btn-logout],[name=btn-join]").on("click",function(){e("[name=btn-menu-toggler]:visible").click()}),e("form[name=search]").on("submit",function(){e("[name=btn-menu-toggler]:visible").click()}),e("[name=btn-menu-toggler]").on("click",function(){setTimeout(function(){e("[name=search]").focus()},1e3)})})(jQuery);